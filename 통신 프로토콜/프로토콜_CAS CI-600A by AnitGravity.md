# CAS CI-600A 통신 프로토콜

## 1. 통신 사양 (RS-232C)
- **Baud Rate**: 설정 가능 (기본값 확인 필요, 보통 9600)
- **Data Bits**: 8
- **Parity**: None (일반적 설정, 매뉴얼 상 핀맵만 존재)
- **Stop Bits**: 1
- **Pin Map (9 Pin)**:
    - 2: RXD (Receive Data)
    - 3: TXD (Transmit Data)
    - 5: GND (Signal Ground)

## 2. 데이터 포맷
### Format 1: 카스의 22 바이트
총 22 바이트의 고정 길이 포맷입니다.

| Byte | 설명 | 예시/값 |
| :--- | :--- | :--- |
| 1~2 | 헤더 1 (상태) | `ST`(안정), `US`(불안정), `OL`(과부하) |
| 3 | 구분자 | `,` (매뉴얼 상 `.`으로 표기되나 보통 `,`) |
| 4~5 | 헤더 2 (중량타입) | `GS`(총중량), `NT`(순중량) |
| 6 | 구분자 | `,` |
| 7 | 장비 번호 (ID) | `1` (ASCII) |
| 8 | 램프 상태 | 비트 필드 (아래 참조) |
| 9 | 구분자 | `,` |
| 10~17 | 데이터 (8 byte) | 우측 정렬, 공백 포함 (예: `   123.4`) |
| 18 | 공백 | ` ` |
| 19~20 | 단위 | `kg`, `t ` |
| 21~22 | 종료 문자 | `CR` `LF` |

**램프 상태 (Byte 8)**
- Bit 0: 영점
- Bit 1: 용기
- Bit 2: 순중량
- Bit 3: 프린트
- Bit 4: 홀드
- Bit 5: 1
- Bit 6: 안정
- Bit 7: 1

### Format 2: 카스의 10 바이트
간소화된 10 바이트 포맷입니다.

| Byte | 설명 | 예시/값 |
| :--- | :--- | :--- |
| 1~8 | 데이터 (8 byte) | 우측 정렬, 공백 포함 |
| 9~10 | 종료 문자 | `CR` `LF` |

### Format 3: 18 바이트
| Byte | 설명 | 예시/값 |
| :--- | :--- | :--- |
| 1~2 | 헤더 1 (상태) | `ST`, `US`, `OL` |
| 3 | 구분자 | `,` |
| 4~5 | 헤더 2 (중량타입) | `GS`, `NT` |
| 6 | 구분자 | `,` |
| 7~14 | 데이터 (8 byte) | 우측 정렬 |
| 15~16 | 단위 | `kg`, `t ` |
| 17~18 | 종료 문자 | `CR` `LF` |

## 3. 명령어 모드 (Command Mode)

### Mode 1 (기본)
PC에서 명령어를 보내면 인디케이터가 응답하는 방식입니다.
명령어 구조: `dd` (장비번호 2자리) + `CMD` (2자리) + `CR` `LF`

| 명령어 | 기능 | 응답 |
| :--- | :--- | :--- |
| **RW** | 무게 데이터 요구 | 설정된 포맷으로 데이터 전송 |
| **MZ** | 영점 (Zero) | `ddMZ` + `CR` `LF` (성공 시) |
| **MT** | 용기 (Tare) | `ddMT` + `CR` `LF` (성공 시) |
| **PN** | 품번 변경 | `ddPN` + `00` (품번) + `CR` `LF` |
| **OP** | 시작 | `ddOP` + `CR` `LF` |
| **EM** | 정지 | `ddEM` + `CR` `LF` |

- **에러 응답**:
    - 수행 불가: `!` + `CR` `LF`
    - 명령 오류: `?` + `CR` `LF`

### Mode 2 (NT-570 호환)
`D` + `ID` + `CMD` + ... 구조를 가집니다.
- `RW`에 해당하는 명령: `D` `ID` `K` `W` `CR` `LF` -> 데이터 반송

### Mode 3 (CI-5000 호환)
- 장비번호 1byte 전송 시 현재 무게 1회 전송
